# MQ Monitor 專案開發報告

## 專案概述

MQ Monitor 是一個用於監控 IBM MQ 佇列管理器、佇列和通道狀態的 Web 應用程式。本報告記錄了專案的開發過程、完成的任務以及遇到的問題和解決方案。

## 開發環境

- **作業系統**：Windows
- **JDK 版本**：Java 21
- **建構工具**：Maven 3.6+
- **IDE**：Visual Studio Code
- **版本控制**：Git

## 開發進度

### 階段一：專案初始化與基礎架構搭建

#### 完成的任務

1. **專案初始化**
   - 使用 Spring Initializr 創建 Spring Boot 專案
   - 配置 Maven 依賴
   - 設定基本專案結構

2. **IBM MQ 連接配置**
   - 添加 IBM MQ Java Client 依賴
   - 創建 MQ 連接配置類
   - 實現 MQ 連接服務

3. **基本架構設計**
   - 設計 MVC 架構
   - 創建控制器、服務和模型層
   - 實現基本的依賴注入

#### 遇到的問題與解決方案

1. **IBM MQ 連接問題**
   - **問題**：初始連接到 IBM MQ 時出現授權錯誤
   - **解決方案**：確保在 application.yml 中正確配置了 MQ 用戶名和密碼，並確認用戶具有適當的權限

2. **依賴版本衝突**
   - **問題**：IBM MQ Client 與 Spring Boot 版本不兼容
   - **解決方案**：更新到兼容的 IBM MQ Client 版本 (9.3.4.0)

### 階段二：核心功能實現

#### 完成的任務

1. **MQ 資源監控功能**
   - 實現佇列管理器狀態監控
   - 實現佇列狀態監控
   - 實現通道狀態監控
   - 使用 PCF 命令獲取詳細資訊

2. **自動重新連線功能**
   - 實現 MQ 連接狀態檢查
   - 實現自動重新連線邏輯
   - 配置定時任務排程器

3. **Web 界面開發**
   - 設計響應式儀表板
   - 實現自動刷新功能
   - 添加手動重新連線按鈕

4. **RESTful API 開發**
   - 實現獲取 MQ 狀態的 API
   - 實現重新連線的 API
   - 添加 Swagger 文檔

#### 遇到的問題與解決方案

1. **PCF 命令執行問題**
   - **問題**：某些 PCF 命令執行時出現權限錯誤
   - **解決方案**：調整 MQ 用戶的權限設置，確保具有執行 PCF 命令的權限

2. **自動重新連線邏輯問題**
   - **問題**：在某些情況下，自動重新連線會導致資源洩漏
   - **解決方案**：優化連接管理邏輯，確保在重新連線前正確關閉舊連接

3. **前端自動刷新問題**
   - **問題**：頻繁的自動刷新導致伺服器負載過高
   - **解決方案**：實現可配置的刷新間隔，並添加倒數計時器

### 階段三：報表功能與優化

#### 完成的任務

1. **PDF 報表功能**
   - 添加 iText 依賴
   - 實現 PDF 報表生成服務
   - 設計報表模板

2. **PDF 預覽功能**
   - 使用 PDF.js 實現瀏覽器中的 PDF 預覽
   - 添加報表預覽頁面
   - 實現報表下載功能

3. **性能優化**
   - 優化 MQ 連接池
   - 實現資料緩存
   - 減少不必要的 MQ 查詢

4. **UI 優化**
   - 改進儀表板佈局
   - 添加更多視覺反饋
   - 優化移動設備顯示

#### 遇到的問題與解決方案

1. **PDF 生成中文顯示問題**
   - **問題**：PDF 中的中文字符顯示為亂碼
   - **解決方案**：添加 iText 的 font-asian 依賴，並使用支援中文的字體

2. **PDF 預覽兼容性問題**
   - **問題**：在某些瀏覽器中 PDF 預覽功能不正常
   - **解決方案**：更新到最新版本的 PDF.js，並添加瀏覽器兼容性檢查

3. **大量數據處理問題**
   - **問題**：當 MQ 中有大量佇列和通道時，頁面載入緩慢
   - **解決方案**：實現分頁加載和懶加載技術，優化數據處理邏輯

### 階段四：測試與部署

#### 完成的任務

1. **單元測試**
   - 為服務層添加單元測試
   - 使用 Mockito 模擬 MQ 連接
   - 測試各種錯誤情況

2. **整合測試**
   - 測試與實際 MQ 伺服器的整合
   - 測試 API 端點
   - 測試自動重新連線功能

3. **文檔完善**
   - 更新 README.md
   - 創建用戶手冊
   - 添加 API 文檔

4. **部署準備**
   - 配置生產環境設置
   - 創建 Docker 容器化配置
   - 準備部署腳本

#### 遇到的問題與解決方案

1. **測試環境問題**
   - **問題**：測試環境中 MQ 配置與生產環境不一致
   - **解決方案**：使用配置文件分離不同環境的設置，並使用環境變數覆蓋敏感資訊

2. **Docker 容器化問題**
   - **問題**：Docker 容器中 JVM 記憶體設置不當導致應用崩潰
   - **解決方案**：優化 JVM 參數設置，並監控容器資源使用情況

## 技術債務與未來改進

1. **安全性增強**
   - 實現更完善的認證機制
   - 加密敏感配置資訊
   - 添加審計日誌

2. **功能擴展**
   - 添加更多 MQ 資源的監控
   - 實現歷史數據統計和趨勢分析
   - 添加警報通知功能

3. **架構優化**
   - 考慮微服務架構
   - 實現更好的錯誤處理機制
   - 優化數據庫設計

4. **UI/UX 改進**
   - 實現更現代化的 UI 設計
   - 添加更多交互功能
   - 支援多語言

## 結論

MQ Monitor 專案成功實現了對 IBM MQ 資源的監控功能，提供了直觀的 Web 界面和完整的 API 接口。通過自動和手動重新連線功能，確保了系統的可靠性。PDF 報表功能為用戶提供了更多的數據分析和分享方式。

專案採用了現代化的技術棧和架構設計，具有良好的可擴展性和可維護性。未來可以根據用戶反饋和需求，進一步優化和擴展系統功能。


## 協調者模式：子任務完成報告（雙模式部署與 JNDI）

- 已調整 Maven 依賴：加入 DB2 JDBC `com.ibm.db2:jcc:12.1.2.0`（scope=provided）
- 已更新 README：新增 Tomcat/Liberty 的 JNDI 設定、JPDA Debug、profile 啟用方式
- 已新增 `application-container.yml`：集中管理 `spring.datasource.jndi-name`
- 已進行建置驗證：`mvn -DskipTests package` 成功
- 已於 spec.md 新增 UML：
  - 部署/模式流程圖（flowchart）
  - JNDI 取得資料來源循序圖（sequence）
  - 組件/物件關聯圖（classDiagram 摘要）

後續待辦
- 選擇 liberty-maven-plugin 安裝方式（使用本機 Liberty 或由外掛自動下載）
- 依你的授權查詢最新穩定版與相容性，並加入 pom.xml（附常用指令與 README 節）

Checkpoint 建議（Conventional Commits）
- feat(db): add DB2 JDBC driver as provided for container-managed JNDI
- docs(readme): add Tomcat & Liberty JNDI setup and JPDA debug guide
- docs(spec): document dual-mode deployment and JNDI UML diagrams
- docs: add container profile and usage notes
